<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.542">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew Ruiz">

<title>Andrew’s Data Analysis Portfolio - cdcdata-exercise</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Andrew’s Data Analysis Portfolio</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../aboutme.html"> 
<span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../starter-analysis-exercise/products/report/starter-analysis-report.html">
 <span class="dropdown-text">Starter Analysis Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../coding-exercise/coding-exercise.html">
 <span class="dropdown-text">R Coding Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../presentation-exercise/presentation-exercise.html">
 <span class="dropdown-text">Presentation Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../tidytuesday-exercise/tidytuesday-exercise.html">
 <span class="dropdown-text">Tidy Tuesday Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../data-exercise/data-exercise.html">
 <span class="dropdown-text">Data Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../cdcdata-exercise/cdcdata-exercsie.html">
 <span class="dropdown-text">CDC Data Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../fitting-exercise/fitting-exercise.html">
 <span class="dropdown-text">Fitting Exercise</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ml-models-exercise/ml-models-exercise.html">
 <span class="dropdown-text">ml-models-exercise</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/anjoru/andrew_ruiz-MADA-portfolio.gitE"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">cdcdata-exercise</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Andrew Ruiz </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>#Load libraries and read data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>here() starts at /Users/andrewruiz/andrew_ruiz-MADA-portfolio</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CSV file using here()</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>rabies2020 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">here</span>(<span class="st">"cdcdata-exercise"</span>, <span class="st">"Rabies2020.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3710 Columns: 23</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (11): Reporting Area, Rabies, Animal, Current week, flag, Rabies, Animal...
dbl  (8): MMWR Year, MMWR Week, Rabies, Animal, Current week, Rabies, Animal...
lgl  (4): Rabies, Human, Current week, Rabies, Human, Previous 52 weeks Max†...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now apply your renaming and cleaning</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rabies2020) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"[^[:alnum:] ]"</span>, <span class="st">""</span>, <span class="fu">names</span>(rabies2020))</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(rabies2020) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, <span class="fu">names</span>(rabies2020))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>rabies2020_cleaned <span class="ot">&lt;-</span> rabies2020</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the column names</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(rabies2020_cleaned))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Reporting_Area"                          
 [2] "MMWR_Year"                               
 [3] "MMWR_Week"                               
 [4] "Rabies_Animal_Current_week"              
 [5] "Rabies_Animal_Current_week_flag"         
 [6] "Rabies_Animal_Previous_52_weeks_Max"     
 [7] "Rabies_Animal_Previous_52_weeks_Max_flag"
 [8] "Rabies_Animal_Cum_2020"                  
 [9] "Rabies_Animal_Cum_2020_flag"             
[10] "Rabies_Animal_Cum_2019"                  
[11] "Rabies_Animal_Cum_2019_flag"             
[12] "Rabies_Human_Current_week"               
[13] "Rabies_Human_Current_week_flag"          
[14] "Rabies_Human_Previous_52_weeks_Max"      
[15] "Rabies_Human_Previous_52_weeks_Max_flag" 
[16] "Rabies_Human_Cum_2020"                   
[17] "Rabies_Human_Cum_2020_flag"              
[18] "Rabies_Human_Cum_2019"                   
[19] "Rabies_Human_Cum_2019_flag"              
[20] "Location_1"                              
[21] "Location_2"                              
[22] "Reporting_Area_Sort"                     
[23] "New_Georeferenced_Column"                </code></pre>
</div>
</div>
<section id="introduction-to-the-data" class="level1">
<h1>Introduction to the data</h1>
<section id="rabies-data-from-the-cdc" class="level2">
<h2 class="anchored" data-anchor-id="rabies-data-from-the-cdc">Rabies data from the CDC</h2>
<section id="this-dataset-was-obtained-from-the-data.cdc.gov-site-link-to-data.-it-contains-the-count-of-animal-and-human-rabies-cases-in-the-us-and-territories-for-2020-and-2019-by-mmwr-week.-since-there-were-no-human-rabies-cases-in-2020-or-2019-this-will-focus-on-animal-cases-only." class="level3">
<h3 class="anchored" data-anchor-id="this-dataset-was-obtained-from-the-data.cdc.gov-site-link-to-data.-it-contains-the-count-of-animal-and-human-rabies-cases-in-the-us-and-territories-for-2020-and-2019-by-mmwr-week.-since-there-were-no-human-rabies-cases-in-2020-or-2019-this-will-focus-on-animal-cases-only.">This dataset was obtained from the data.cdc.gov site <a href="https://data.cdc.gov/NNDSS/NNDSS-TABLE-1CC-Rabies-Animal-to-Rabies-Human/6kf3-4udg/about_data">link to data</a>. It contains the count of animal and human rabies cases in the US and territories for 2020 and 2019 by MMWR Week. Since there were no human rabies cases in 2020 or 2019, this will focus on animal cases only.</h3>
</section>
<section id="unlike-human-cases-which-rarely-go-undiagnosed-animal-cases-are-more-prone-to-surveillance-bias.-comparing-the-counts-from-2020-to-2019-may-be-an-important-indicator-of-the-effects-of-limited-public-health-lab-testing-in-the-first-year-of-the-pandemic-when-public-health-staff-were-diverted-to-support-covid-operations-and-some-labs-were-closed." class="level3">
<h3 class="anchored" data-anchor-id="unlike-human-cases-which-rarely-go-undiagnosed-animal-cases-are-more-prone-to-surveillance-bias.-comparing-the-counts-from-2020-to-2019-may-be-an-important-indicator-of-the-effects-of-limited-public-health-lab-testing-in-the-first-year-of-the-pandemic-when-public-health-staff-were-diverted-to-support-covid-operations-and-some-labs-were-closed.">Unlike human cases, which rarely go undiagnosed, animal cases are more prone to surveillance bias. Comparing the counts from 2020 to 2019, may be an important indicator of the effects of limited public health lab testing in the first year of the pandemic when public health staff were diverted to support COVID operations and some labs were closed.</h3>
<section id="lets-look-at-the-first-few-rows" class="level4">
<h4 class="anchored" data-anchor-id="lets-look-at-the-first-few-rows">Let’s look at the first few rows</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(rabies2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 23
  Reporting_Area MMWR_Year MMWR_Week Rabies_Animal_Current_week
  &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;                      &lt;dbl&gt;
1 MASSACHUSETTS       2020         1                         NA
2 US RESIDENTS        2020         1                         16
3 WASHINGTON          2020         1                         NA
4 HAWAII              2020         1                         NA
5 WISCONSIN           2020         1                         NA
6 MARYLAND            2020         1                         NA
# ℹ 19 more variables: Rabies_Animal_Current_week_flag &lt;chr&gt;,
#   Rabies_Animal_Previous_52_weeks_Max &lt;dbl&gt;,
#   Rabies_Animal_Previous_52_weeks_Max_flag &lt;chr&gt;,
#   Rabies_Animal_Cum_2020 &lt;dbl&gt;, Rabies_Animal_Cum_2020_flag &lt;chr&gt;,
#   Rabies_Animal_Cum_2019 &lt;dbl&gt;, Rabies_Animal_Cum_2019_flag &lt;chr&gt;,
#   Rabies_Human_Current_week &lt;lgl&gt;, Rabies_Human_Current_week_flag &lt;chr&gt;,
#   Rabies_Human_Previous_52_weeks_Max &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(rabies2020))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Reporting_Area"                          
 [2] "MMWR_Year"                               
 [3] "MMWR_Week"                               
 [4] "Rabies_Animal_Current_week"              
 [5] "Rabies_Animal_Current_week_flag"         
 [6] "Rabies_Animal_Previous_52_weeks_Max"     
 [7] "Rabies_Animal_Previous_52_weeks_Max_flag"
 [8] "Rabies_Animal_Cum_2020"                  
 [9] "Rabies_Animal_Cum_2020_flag"             
[10] "Rabies_Animal_Cum_2019"                  
[11] "Rabies_Animal_Cum_2019_flag"             
[12] "Rabies_Human_Current_week"               
[13] "Rabies_Human_Current_week_flag"          
[14] "Rabies_Human_Previous_52_weeks_Max"      
[15] "Rabies_Human_Previous_52_weeks_Max_flag" 
[16] "Rabies_Human_Cum_2020"                   
[17] "Rabies_Human_Cum_2020_flag"              
[18] "Rabies_Human_Cum_2019"                   
[19] "Rabies_Human_Cum_2019_flag"              
[20] "Location_1"                              
[21] "Location_2"                              
[22] "Reporting_Area_Sort"                     
[23] "New_Georeferenced_Column"                </code></pre>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="clean-and-process-the-data" class="level1">
<h1>Clean and process the data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the column names have special characters that I will remove</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#names(rabies2020) &lt;- gsub("[^[:alnum:] ]", "", names(rabies2020))</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#names(rabies2020) &lt;- gsub(" ", "_", names(rabies2020))</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#print(names(rabies2020))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#now select the variables we will need</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>rabies2020_selected <span class="ot">&lt;-</span> rabies2020_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    Reporting_Area, </span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    MMWR_Week,      </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    Rabies_Animal_Current_week,  </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    Rabies_Animal_Cum_2019,      </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    Location_1,    </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    Location_2</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Some of the count data has missing values.</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co"># these can be replaced with zeros</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NA values with 0</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rabies_Animal_Current_week =</span> <span class="fu">replace_na</span>(Rabies_Animal_Current_week, <span class="dv">0</span>),</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Rabies_Animal_Cum_2019 =</span> <span class="fu">replace_na</span>(Rabies_Animal_Cum_2019, <span class="dv">0</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(rabies2020_selected))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Reporting_Area"             "MMWR_Week"                 
[3] "Rabies_Animal_Current_week" "Rabies_Animal_Cum_2019"    
[5] "Location_1"                 "Location_2"                </code></pre>
</div>
</div>
<section id="now-that-the-data-is-cleaner-lets-focus-on-the-south-atlantic-region-for-the-rest-of-the-analysis." class="level2">
<h2 class="anchored" data-anchor-id="now-that-the-data-is-cleaner-lets-focus-on-the-south-atlantic-region-for-the-rest-of-the-analysis.">Now that the data is cleaner, let’s focus on the South Atlantic region for the rest of the analysis.</h2>
<section id="the-original-dataset-does-not-provide-the-incident-case-count-by-mmwr-week-for-2019.-instead-it-only-has-the-cumulative-cases-by-week.-we-will-have-to-create-a-calculate-field-for-this-so-that-we-can-make-some-comparisons-between-the-years." class="level3">
<h3 class="anchored" data-anchor-id="the-original-dataset-does-not-provide-the-incident-case-count-by-mmwr-week-for-2019.-instead-it-only-has-the-cumulative-cases-by-week.-we-will-have-to-create-a-calculate-field-for-this-so-that-we-can-make-some-comparisons-between-the-years.">The original dataset does not provide the incident case count by MMWR week for 2019. Instead it only has the cumulative cases by week. We will have to create a calculate field for this so that we can make some comparisons between the years.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on South Atlantic state for the rest of the analysis</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>south_atlantic_data <span class="ot">&lt;-</span> rabies2020_selected <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Location_2 <span class="sc">==</span> <span class="st">"SOUTH ATLANTIC"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate incident cases for 2019</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Reporting_Area, MMWR_Week) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Reporting_Area) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Incident_Cases_2019 =</span> Rabies_Animal_Cum_2019 <span class="sc">-</span> <span class="fu">lag</span>(Rabies_Animal_Cum_2019, <span class="at">default =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(south_atlantic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [53 × 7] (S3: tbl_df/tbl/data.frame)
 $ Reporting_Area            : chr [1:53] "SOUTH ATLANTIC" "SOUTH ATLANTIC" "SOUTH ATLANTIC" "SOUTH ATLANTIC" ...
 $ MMWR_Week                 : num [1:53] 1 2 3 4 5 6 7 8 9 10 ...
 $ Rabies_Animal_Current_week: num [1:53] 12 9 4 5 3 4 5 5 7 0 ...
 $ Rabies_Animal_Cum_2019    : num [1:53] 9 77 107 135 154 164 169 182 197 212 ...
 $ Location_1                : chr [1:53] NA NA NA NA ...
 $ Location_2                : chr [1:53] "SOUTH ATLANTIC" "SOUTH ATLANTIC" "SOUTH ATLANTIC" "SOUTH ATLANTIC" ...
 $ Incident_Cases_2019       : num [1:53] 9 68 30 28 19 10 5 13 15 15 ...</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="visualizing-the-data" class="level1">
<h1>Visualizing the data</h1>
<section id="lets-create-a-line-graph-with-the-counts-by-mmwr-week-for-both-2020-and-2019." class="level2">
<h2 class="anchored" data-anchor-id="lets-create-a-line-graph-with-the-counts-by-mmwr-week-for-both-2020-and-2019.">Let’s create a line graph with the counts by MMWR week for both 2020 and 2019.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for graphing: Pivot to long format for both 2019 and 2020</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>south_atlantic_long <span class="ot">&lt;-</span> south_atlantic_data <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure MMWR_Week and Reporting_Area are retained for grouping in the long format</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Incident_Cases_2019, Rabies_Animal_Current_week), </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Year"</span>, </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct the Year column to reflect actual years</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">recode</span>(Year, </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Incident_Cases_2019 =</span> <span class="st">"2019"</span>, </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Rabies_Animal_Current_week =</span> <span class="st">"2020"</span>))</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(south_atlantic_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  Reporting_Area MMWR_Week Rabies_Animal_Cum_2019 Location_1 Location_2    Year 
  &lt;chr&gt;              &lt;dbl&gt;                  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;         &lt;chr&gt;
1 SOUTH ATLANTIC         1                      9 &lt;NA&gt;       SOUTH ATLANT… 2019 
2 SOUTH ATLANTIC         1                      9 &lt;NA&gt;       SOUTH ATLANT… 2020 
3 SOUTH ATLANTIC         2                     77 &lt;NA&gt;       SOUTH ATLANT… 2019 
4 SOUTH ATLANTIC         2                     77 &lt;NA&gt;       SOUTH ATLANT… 2020 
5 SOUTH ATLANTIC         3                    107 &lt;NA&gt;       SOUTH ATLANT… 2019 
6 SOUTH ATLANTIC         3                    107 &lt;NA&gt;       SOUTH ATLANT… 2020 
# ℹ 1 more variable: Cases &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph the incident animal cases from 2019 and 2020 by MMWR week</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(south_atlantic_long, <span class="fu">aes</span>(<span class="at">x =</span> MMWR_Week, <span class="at">y =</span> Cases, <span class="at">color =</span> Year, <span class="at">group =</span> Year)) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Rabies Cases by MMWR Week for 2019 and 2020 in South Atlantic"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"MMWR Week"</span>,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Cases"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"2019"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2020"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets compare the two years with a box plot</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(south_atlantic_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Cases, <span class="at">color =</span> Year)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Weekly Rabies Cases for 2019 and 2020"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="this-analysis-aims-to-understand-the-trends-in-animal-rabies-cases-reported-in-the-south-atlantic-region-during-2019-assess-the-models-fit-and-forecast-future-cases-into-the-next-year.-we-employ-time-series-analysis-techniques-focusing-on-arima-modeling-to-capture-the-underlying-patterns-in-the-weekly-reported-cases-and-predict-future-occurrences.-the-process-encompasses-data-preparation-visualization-model-selection-and-diagnostics-and-forecasting-culminating-in-a-comparison-of-forecasted-cases-against-actual-data-from-2020." class="level3">
<h3 class="anchored" data-anchor-id="this-analysis-aims-to-understand-the-trends-in-animal-rabies-cases-reported-in-the-south-atlantic-region-during-2019-assess-the-models-fit-and-forecast-future-cases-into-the-next-year.-we-employ-time-series-analysis-techniques-focusing-on-arima-modeling-to-capture-the-underlying-patterns-in-the-weekly-reported-cases-and-predict-future-occurrences.-the-process-encompasses-data-preparation-visualization-model-selection-and-diagnostics-and-forecasting-culminating-in-a-comparison-of-forecasted-cases-against-actual-data-from-2020.">This analysis aims to understand the trends in animal rabies cases reported in the South Atlantic region during 2019, assess the model’s fit, and forecast future cases into the next year. We employ time series analysis techniques, focusing on ARIMA modeling, to capture the underlying patterns in the weekly reported cases and predict future occurrences. The process encompasses data preparation, visualization, model selection and diagnostics, and forecasting, culminating in a comparison of forecasted cases against actual data from 2020.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the time series data</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>time_series_data <span class="ot">&lt;-</span> south_atlantic_data <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(MMWR_Week, Incident_Cases_2019) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MMWR_Week =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(<span class="st">"2020-"</span>, MMWR_Week, <span class="st">"-1"</span>), <span class="at">format =</span> <span class="st">"%Y-%U-%u"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `MMWR_Week = as.Date(paste0("2020-", MMWR_Week, "-1"), format =
  "%Y-%U-%u")`.
Caused by warning in `strptime()`:
! (0-based) yday 369 in year 2020 is invalid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to time series object</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ts_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(time_series_data<span class="sc">$</span>Incident_Cases_2019, <span class="at">frequency =</span> <span class="dv">53</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Time Series Visualization</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ts_data, <span class="at">main =</span> <span class="st">"Time Series of Rabies Animal Cases by MMWR Week for 2019"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modeling (Auto ARIMA)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_data)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic Checking</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(arima_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,1,1)
Q* = 16.92, df = 8, p-value = 0.03096

Model df: 3.   Total lags used: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The Ljung-Box test examined the residuals from an ARIMA(2,1,1) model </span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#to see if they are correlated with each other. The test statistic (Q*) </span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#was 16.92 with 8 degrees of freedom, resulting in a p-value of 0.03096. </span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co">#This suggests that there is evidence of autocorrelation in the residuals, </span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co">#indicating that the ARIMA model may not fully capture the underlying patterns </span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#in the data.</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>forecast_values <span class="ot">&lt;-</span> <span class="fu">forecast</span>(arima_model, <span class="at">h =</span> <span class="dv">52</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast_values, main = "Forecast of Rabies Animal Cases for the Next 52 Weeks")</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast and Actual 2020 Cases</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have the actual 2020 cases data stored in a variable called actual_2020_cases</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast and Actual 2020 Cases</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_values, <span class="at">main =</span> <span class="st">"Forecast vs Actual Rabies Animal Cases for 2020"</span>)</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(south_atlantic_data<span class="sc">$</span>Rabies_Animal_Current_week, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)  <span class="co"># Add actual 2020 cases to the plot</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span>, <span class="st">"Actual 2020 Cases"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="the-ljung-box-test-examined-the-residuals-from-an-arima211-model-to-see-if-they-are-correlated-with-each-other.-the-test-statistic-q-was-16.92-with-8-degrees-of-freedom-resulting-in-a-p-value-of-0.03096.-this-suggests-that-there-is-evidence-of-autocorrelation-in-the-residuals-indicating-that-the-arima-model-may-not-fully-capture-the-underlying-patterns-in-the-data." class="level4">
<h4 class="anchored" data-anchor-id="the-ljung-box-test-examined-the-residuals-from-an-arima211-model-to-see-if-they-are-correlated-with-each-other.-the-test-statistic-q-was-16.92-with-8-degrees-of-freedom-resulting-in-a-p-value-of-0.03096.-this-suggests-that-there-is-evidence-of-autocorrelation-in-the-residuals-indicating-that-the-arima-model-may-not-fully-capture-the-underlying-patterns-in-the-data.">The Ljung-Box test examined the residuals from an ARIMA(2,1,1) model to see if they are correlated with each other. The test statistic (Q*) was 16.92 with 8 degrees of freedom, resulting in a p-value of 0.03096. This suggests that there is evidence of autocorrelation in the residuals, indicating that the ARIMA model may not fully capture the underlying patterns in the data.</h4>
</section>
</section>
</section>
</section>
<section id="part-2" class="level1">
<h1>Part 2</h1>
<section id="contributed-by-xueyan-hu" class="level2">
<h2 class="anchored" data-anchor-id="contributed-by-xueyan-hu">Contributed by Xueyan Hu</h2>
<section id="first-creating-a-synthetic-dataset" class="level3">
<h3 class="anchored" data-anchor-id="first-creating-a-synthetic-dataset">First creating a synthetic dataset</h3>
<p>I asked AI tool google Gemini to create the codes for generating a synthetic dataset that will look like the cleaned dataset done by Andrew, but I used different names and random 2 continuous year for this synthetic dataset. It contains reporting area, the number of wwmr week in a physical year, cumulative incident of a disease (here for mine is covid) in the first year, incident cases in first year and incident cases in second year. The result was rough and wasn’t so consistant to Andrew’s original dataset, so then I asked chatGPT 3.5 to add more conditions and also by myself. The final code is as below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the seed for reproducible random numbers (optional)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the number of weeks</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>num_weeks <span class="ot">&lt;-</span> <span class="dv">53</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create vectors for each variable</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>reporting_area <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Hogwarts"</span>, num_weeks)  <span class="co"># All Hogwarts</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>mmwr_week <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>num_weeks, <span class="at">each =</span> <span class="dv">1</span>)  <span class="co"># Weeks 1 to 53</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the desired median</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>desired_median <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random cases between 0-18 each week</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>covid_current_week <span class="ot">&lt;-</span> <span class="fu">round</span>(</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(<span class="fu">runif</span>(num_weeks) <span class="sc">&lt;</span> <span class="fl">0.01</span>,  <span class="co"># 5% chance of 0</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>         <span class="fu">runif</span>(num_weeks, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">18</span>)),  <span class="co"># Remaining 95% with range</span></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">0</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the current median</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>current_median <span class="ot">&lt;-</span> <span class="fu">median</span>(covid_current_week)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the adjustment needed for the median</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>median_adjustment <span class="ot">&lt;-</span> desired_median <span class="sc">-</span> current_median</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the adjustment to the data</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>covid_current_week <span class="ot">&lt;-</span> covid_current_week <span class="sc">+</span> median_adjustment</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all values are non-negative</span></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>covid_current_week <span class="ot">&lt;-</span> <span class="fu">pmax</span>(covid_current_week, <span class="dv">0</span>)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the resulting covid_current_week vector</span></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a>covid_current_week</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0  7  1  0 11 13  4  9  0  4  2 12  5 12 12 11  5 11  8 10  0  6  1  4  8
[26]  3  0  1  9  5 11  0  5 15 13 13  0  0  9  3  9  3  0 11  0  5  6  8  3  6
[51] 14  6 13</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the target median</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>target_median <span class="ot">&lt;-</span> <span class="dv">14</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the fixed values and the number of weeks</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>fixed_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">70</span>, <span class="dv">30</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>num_fixed_weeks <span class="ot">&lt;-</span> <span class="fu">length</span>(fixed_values)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>total_weeks <span class="ot">&lt;-</span> <span class="dv">53</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the number of fluctuating weeks</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>num_fluctuating_weeks <span class="ot">&lt;-</span> total_weeks <span class="sc">-</span> num_fixed_weeks</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the sum of fixed values</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>fixed_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(fixed_values)</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the target sum for the fluctuating weeks</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>target_sum_fluctuating <span class="ot">&lt;-</span> target_median <span class="sc">*</span> num_fluctuating_weeks <span class="sc">-</span> fixed_sum</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate random fluctuations with the adjusted sum</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>fluctuations <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(num_fluctuating_weeks, <span class="at">mean =</span> target_sum_fluctuating <span class="sc">/</span> num_fluctuating_weeks, <span class="at">sd =</span> <span class="dv">5</span>))</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure all elements are non-negative</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>fluctuations <span class="ot">&lt;-</span> <span class="fu">pmax</span>(fluctuations, <span class="dv">0</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine fixed values and fluctuations</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>incident_case_2020 <span class="ot">&lt;-</span> <span class="fu">c</span>(fixed_values, fluctuations)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Enforce zeros for week 52 and 53</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>incident_case_2020[<span class="dv">52</span><span class="sc">:</span><span class="dv">53</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Create empty vectors for Location_1 and Location_2</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>location_1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, num_weeks)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>location_2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="st">"Hogwarts"</span>, num_weeks)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the first week to 12 and decrease to 5 on week 5</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>covid_current_week[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>covid_current_week[<span class="dv">5</span>] <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Set last week to 0</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>covid_current_week[num_weeks] <span class="ot">&lt;-</span> <span class="dv">0</span>  </span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the data frame</span></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>hogwarts_covid_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">Reporting_Area =</span> reporting_area,</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">MMWR_Week =</span> mmwr_week,</span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covid_Current_Week =</span> covid_current_week,</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">Covid_Cum_2020 =</span> <span class="fu">cumsum</span>(incident_case_2020),  <span class="co"># Cumulative cases</span></span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">Location_1 =</span> location_1,</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">Location_2 =</span> <span class="fu">rep</span>(<span class="st">"Hogwarts"</span>, num_weeks),</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Incident_Case_2020 =</span> incident_case_2020</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a><span class="co"># View the data frame</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hogwarts_covid_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Reporting_Area MMWR_Week Covid_Current_Week Covid_Cum_2020 Location_1
1        Hogwarts         1                 12             10         NA
2        Hogwarts         2                  7             80         NA
3        Hogwarts         3                  1            110         NA
4        Hogwarts         4                  0            129         NA
5        Hogwarts         5                  5            140         NA
6        Hogwarts         6                 13            159         NA
7        Hogwarts         7                  4            163         NA
8        Hogwarts         8                  9            178         NA
9        Hogwarts         9                  0            190         NA
10       Hogwarts        10                  4            203         NA
11       Hogwarts        11                  2            217         NA
12       Hogwarts        12                 12            226         NA
13       Hogwarts        13                  5            236         NA
14       Hogwarts        14                 12            243         NA
15       Hogwarts        15                 12            249         NA
16       Hogwarts        16                 11            262         NA
17       Hogwarts        17                  5            276         NA
18       Hogwarts        18                 11            288         NA
19       Hogwarts        19                  8            304         NA
20       Hogwarts        20                 10            326         NA
21       Hogwarts        21                  0            335         NA
22       Hogwarts        22                  6            335         NA
23       Hogwarts        23                  1            352         NA
24       Hogwarts        24                  4            360         NA
25       Hogwarts        25                  8            368         NA
26       Hogwarts        26                  3            385         NA
27       Hogwarts        27                  0            395         NA
28       Hogwarts        28                  1            401         NA
29       Hogwarts        29                  9            414         NA
30       Hogwarts        30                  5            425         NA
31       Hogwarts        31                 11            437         NA
32       Hogwarts        32                  0            451         NA
33       Hogwarts        33                  5            461         NA
34       Hogwarts        34                 15            476         NA
35       Hogwarts        35                 13            487         NA
36       Hogwarts        36                 13            500         NA
37       Hogwarts        37                  0            517         NA
38       Hogwarts        38                  0            531         NA
39       Hogwarts        39                  9            541         NA
40       Hogwarts        40                  3            559         NA
41       Hogwarts        41                  9            576         NA
42       Hogwarts        42                  3            591         NA
43       Hogwarts        43                  0            604         NA
44       Hogwarts        44                 11            613         NA
45       Hogwarts        45                  0            632         NA
46       Hogwarts        46                  5            641         NA
47       Hogwarts        47                  6            664         NA
48       Hogwarts        48                  8            683         NA
49       Hogwarts        49                  3            694         NA
50       Hogwarts        50                  6            701         NA
51       Hogwarts        51                 14            709         NA
52       Hogwarts        52                  6            709         NA
53       Hogwarts        53                  0            709         NA
   Location_2 Incident_Case_2020
1    Hogwarts                 10
2    Hogwarts                 70
3    Hogwarts                 30
4    Hogwarts                 19
5    Hogwarts                 11
6    Hogwarts                 19
7    Hogwarts                  4
8    Hogwarts                 15
9    Hogwarts                 12
10   Hogwarts                 13
11   Hogwarts                 14
12   Hogwarts                  9
13   Hogwarts                 10
14   Hogwarts                  7
15   Hogwarts                  6
16   Hogwarts                 13
17   Hogwarts                 14
18   Hogwarts                 12
19   Hogwarts                 16
20   Hogwarts                 22
21   Hogwarts                  9
22   Hogwarts                  0
23   Hogwarts                 17
24   Hogwarts                  8
25   Hogwarts                  8
26   Hogwarts                 17
27   Hogwarts                 10
28   Hogwarts                  6
29   Hogwarts                 13
30   Hogwarts                 11
31   Hogwarts                 12
32   Hogwarts                 14
33   Hogwarts                 10
34   Hogwarts                 15
35   Hogwarts                 11
36   Hogwarts                 13
37   Hogwarts                 17
38   Hogwarts                 14
39   Hogwarts                 10
40   Hogwarts                 18
41   Hogwarts                 17
42   Hogwarts                 15
43   Hogwarts                 13
44   Hogwarts                  9
45   Hogwarts                 19
46   Hogwarts                  9
47   Hogwarts                 23
48   Hogwarts                 19
49   Hogwarts                 11
50   Hogwarts                  7
51   Hogwarts                  8
52   Hogwarts                  0
53   Hogwarts                  0</code></pre>
</div>
</div>
</section>
<section id="line-graph-for-incident-case-by-mmwr-week" class="level3">
<h3 class="anchored" data-anchor-id="line-graph-for-incident-case-by-mmwr-week">line graph for incident case by MMWR Week</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for graphing: Pivot to long format for both 2020 and 2021</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>covid_data_long <span class="ot">&lt;-</span> hogwarts_covid_data <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(Incident_Case_2020, Covid_Current_Week), </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"Year"</span>, </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"Cases"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct the Year column to reflect actual years</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">recode</span>(Year, </span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Incident_Case_2020 =</span> <span class="st">"2020"</span>, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">Covid_Current_Week =</span> <span class="st">"2021"</span>))</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(covid_data_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 7
  Reporting_Area MMWR_Week Covid_Cum_2020 Location_1 Location_2 Year  Cases
  &lt;chr&gt;              &lt;int&gt;          &lt;dbl&gt; &lt;lgl&gt;      &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;
1 Hogwarts               1             10 NA         Hogwarts   2020     10
2 Hogwarts               1             10 NA         Hogwarts   2021     12
3 Hogwarts               2             80 NA         Hogwarts   2020     70
4 Hogwarts               2             80 NA         Hogwarts   2021      7
5 Hogwarts               3            110 NA         Hogwarts   2020     30
6 Hogwarts               3            110 NA         Hogwarts   2021      1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Graph the incident animal cases from 2020 and 2021 by MMWR week</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covid_data_long, <span class="fu">aes</span>(<span class="at">x =</span> MMWR_Week, <span class="at">y =</span> Cases, <span class="at">color =</span> Year, <span class="at">group =</span> Year)) <span class="sc">+</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Covid Cases by MMWR Week for 2020 and 2021 in Hogwarts"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"MMWR Week"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Cases"</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"2020"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2021"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For this line graph, I think the general trend of each year is similar with the orginal data. I noticed the feature of first year that the case number peaked at a really high point and then decreased dramatically in the several following weeks. And both first year and second year dropped to about 0 case in the last few weeks. And the average of incidence in first year is higher than second year. I tried to ask AI tool to mimic these features for me.</p>
</section>
<section id="boxplot-for-incident-case-by-year" class="level3">
<h3 class="anchored" data-anchor-id="boxplot-for-incident-case-by-year">boxplot for incident case by year</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets compare the two years with a box plot</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(covid_data_long, <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Cases, <span class="at">color =</span> Year)) <span class="sc">+</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Weekly covid Cases for 2020 and 2021"</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Number of Cases"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>I think basically the boxplot has similar shape with the one generated by original data, like the medium line, out liners. But there are still some differences that I cannot eliminate. First, the 3rd quartiles and 1st quartiles are different from the original data. I have tried to ask AI tools to define the fixed values but it didn’t work well. So I only keep the right median. I couldn’t control the height of the boxes.</p>
<p><strong>???</strong> I don’t really know the model named ARIMA that Andrew use for doing forecasting in the last section of part 1 above. But I will copy and paste his code and run it to see what will happen here for the synthetic dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the time series data</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>time_series_covid_data <span class="ot">&lt;-</span> hogwarts_covid_data <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MMWR_Week =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(<span class="st">"2021-"</span>, MMWR_Week, <span class="st">"-1"</span>), <span class="at">format =</span> <span class="st">"%Y-%U-%u"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(MMWR_Week, Incident_Case_2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `MMWR_Week = as.Date(paste0("2021-", MMWR_Week, "-1"), format =
  "%Y-%U-%u")`.
Caused by warning in `strptime()`:
! (0-based) yday 367 in year 2021 is invalid</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to time series object</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>ts_covid_data <span class="ot">&lt;-</span> <span class="fu">ts</span>(time_series_covid_data<span class="sc">$</span>Incident_Case_2020, <span class="at">frequency =</span> <span class="dv">53</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Time Series Visualization</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ts_covid_data, <span class="at">main =</span> <span class="st">"Time Series of Synthetic Covid Cases by MMWR Week for 2020"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Modeling (Auto ARIMA)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>covid_arima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(ts_covid_data)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Diagnostic Checking</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(covid_arima_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Ljung-Box test

data:  Residuals from ARIMA(2,0,0) with non-zero mean
Q* = 2.6713, df = 9, p-value = 0.9759

Model df: 2.   Total lags used: 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The Ljung-Box test examined the residuals from an ARIMA(2,1,1) model </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co">#to see if they are correlated with each other. The test statistic (Q*) </span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">#was 16.92 with 8 degrees of freedom, resulting in a p-value of 0.03096. </span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">#This suggests that there is evidence of autocorrelation in the residuals, </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co">#indicating that the ARIMA model may not fully capture the underlying patterns </span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#in the data.</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Forecasting</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>forecast_values_covid <span class="ot">&lt;-</span> <span class="fu">forecast</span>(covid_arima_model, <span class="at">h =</span> <span class="dv">52</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(forecast_values, main = "Forecast of Rabies Animal Cases for the Next 52 Weeks")</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast and Actual 2020 Cases</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming you have the actual 2020 cases data stored in a variable called actual_2020_cases</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Forecast and Actual 2020 Cases</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_values_covid, <span class="at">main =</span> <span class="st">"Forecast vs Synthetic Covid Cases for 2021"</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(hogwarts_covid_data<span class="sc">$</span>Covid_Current_Week, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">lwd =</span> <span class="dv">2</span>)  <span class="co"># Add actual 2020 cases to the plot</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>, <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"Forecast"</span>, <span class="st">"Syntheric 2020 Cases"</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"blue"</span>), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cdcdata-exercsie_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<!-- ### First creating a synthetic dataset -->
<!-- ```{r} -->
<!-- # Set seed for reproducibility -->
<!-- set.seed(123) -->
<!-- # Generate MMWR weeks from 1 to 53 -->
<!-- mmwr_weeks <- 1:53 -->
<!-- # Generate synthetic data for 2020 (weekly incident cases) -->
<!-- covid_weekly_2020 <- sample(1:100, 53, replace = TRUE) -->
<!-- # Generate synthetic data for 2021 (weekly incident cases) -->
<!-- # Ensure that 2021 cases are overall higher than 2020 -->
<!-- covid_weekly_2021 <- covid_weekly_2020 + sample(50:150, 53, replace = TRUE) + 50 -->
<!-- # Create reporting area variable -->
<!-- reporting_area <- rep("Hogwarts", 53 * 2) -->
<!-- # Combine data for 2020 and 2021 -->
<!-- covid_data <- data.frame( -->
<!--   MMWR_Week = rep(mmwr_weeks, 2), -->
<!--   Covid_Cum_2020 = c(covid_weekly_2020, rep(NA, 53)),  # Placeholder for 2021 weekly counts -->
<!--   Covid_Current_Week_2021 = c(rep(NA, 53), covid_weekly_2021),  # 2021 weekly counts -->
<!--   Reporting_Area = reporting_area -->
<!-- ) -->
<!-- # Replace NA values for 2021 with a lower limit -->
<!-- covid_data$Covid_Cum_2020[54:106] <- cumsum(pmin(10000, pmax(0, covid_weekly_2021))) -->
<!-- # Add variation to incident cases in 2021 -->
<!-- covid_data$Covid_Current_Week_2021[54:106] <- pmin(10000, pmax(0, covid_data$Covid_Cum_2020[53] + sample(100:500, 53, replace = TRUE))) -->
<!-- # Remove the NA values from the weekly counts for 2021 -->
<!-- covid_data <- covid_data[complete.cases(covid_data), ] -->
<!-- # Print the generated dataset -->
<!-- print(covid_data) -->
<!-- ``` -->
<!-- ### calculate weekly incident for 2020 -->
<!-- ```{r} -->
<!-- new_covid_data <- covid_data %>% -->
<!--   mutate(Incident_Cases_2020 = Covid_Cum_2020 - lag(Covid_Cum_2020, default = 0)) -->
<!-- str(new_covid_data) -->
<!-- head(new_covid_data) -->
<!-- ``` -->
<!-- ### line graph for incident case by MMWR Week -->
<!-- ```{r} -->
<!-- # Prepare data for graphing: Pivot to long format for both 2020 and 2021 -->
<!-- covid_data_long <- new_covid_data %>% -->
<!--   pivot_longer(cols = c(Incident_Cases_2020, Covid_Current_Week_2021),  -->
<!--                names_to = "Year",  -->
<!--                values_to = "Cases") %>% -->
<!--   # Correct the Year column to reflect actual years -->
<!--   mutate(Year = recode(Year,  -->
<!--                        Incident_Cases_2020 = "2020",  -->
<!--                        Covid_Current_Week_2021 = "2021")) -->
<!-- head(covid_data_long) -->
<!-- # Graph the incident animal cases from 2020 and 2021 by MMWR week -->
<!-- ggplot(covid_data_long, aes(x = MMWR_Week, y = Cases, color = Year, group = Year)) + -->
<!--   geom_line() + -->
<!--   geom_point() + -->
<!--   theme_minimal() + -->
<!--   labs(title = "Covid Cases by MMWR Week for 2020 and 2021 in Hogwarts", -->
<!--        x = "MMWR Week", -->
<!--        y = "Number of Cases", -->
<!--        color = "Year") + -->
<!--   scale_color_manual(values = c("2020" = "blue", "2021" = "red")) -->
<!-- ``` -->
<!-- ### boxplot for incident case by year -->
<!-- ```{r} -->
<!-- # Lets compare the two years with a box plot -->
<!-- ggplot(covid_data_long, aes(x = Year, y = Cases, color = Year)) + -->
<!--   geom_boxplot() + -->
<!--   theme_minimal() + -->
<!--   labs(title = "Distribution of Weekly covid Cases for 2020 and 2021", -->
<!--        x = "Year", -->
<!--        y = "Number of Cases") -->
<!-- ``` -->
<!-- **???** I don't really know the model named ARIMA that Andrew use for doing forecasting in the last section of part 1 above. But I will copy and paste his code and run it to see what will happen here for the synthetic dataset. -->
<!-- ```{r} -->
<!-- # Prepare the time series data -->
<!-- time_series_covid_data <- new_covid_data %>% -->
<!--   mutate(MMWR_Week = as.Date(paste0("2021-", MMWR_Week, "-1"), format = "%Y-%U-%u")) %>% -->
<!--   select(MMWR_Week, Incident_Cases_2020) -->
<!-- # Convert to time series object -->
<!-- ts_covid_data <- ts(time_series_covid_data$Incident_Cases_2020, frequency = 53) -->
<!-- # Time Series Visualization -->
<!-- plot(ts_covid_data, main = "Time Series of Synthetic Covid Cases by MMWR Week for 2020") -->
<!-- # Modeling (Auto ARIMA) -->
<!-- covid_arima_model <- auto.arima(ts_covid_data) -->
<!-- # Diagnostic Checking -->
<!-- checkresiduals(covid_arima_model) -->
<!-- # The Ljung-Box test examined the residuals from an ARIMA(2,1,1) model  -->
<!-- #to see if they are correlated with each other. The test statistic (Q*)  -->
<!-- #was 16.92 with 8 degrees of freedom, resulting in a p-value of 0.03096.  -->
<!-- #This suggests that there is evidence of autocorrelation in the residuals,  -->
<!-- #indicating that the ARIMA model may not fully capture the underlying patterns  -->
<!-- #in the data. -->
<!-- # Forecasting -->
<!-- forecast_values_covid <- forecast(covid_arima_model, h = 52) -->
<!-- # Plot Forecast -->
<!-- #plot(forecast_values, main = "Forecast of Rabies Animal Cases for the Next 52 Weeks") -->
<!-- # Plot Forecast and Actual 2020 Cases -->
<!-- # Assuming you have the actual 2020 cases data stored in a variable called actual_2020_cases -->
<!-- # Plot Forecast and Actual 2020 Cases -->
<!-- plot(forecast_values_covid, main = "Forecast vs Synthetic Covid Cases for 2021") -->
<!-- lines(new_covid_data$Covid_Current_Week_2021, col = "blue", lty = 2, lwd = 2)  # Add actual 2020 cases to the plot -->
<!-- # Add legend -->
<!-- legend("topright", legend = c("Forecast", "Syntheric 2020 Cases"), col = c("black", "blue"), lty = c(1, 2), lwd = c(1, 2)) -->
<!-- ``` -->


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>